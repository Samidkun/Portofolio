---
import { projects } from "../data/projects";
---

<section id="projects" class="py-20 px-10 bg-black text-white">
  <h2 class="text-3xl font-bold mb-12 text-center">My Projects</h2>

  <style>
    .project-card {
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0.08) 0%,
        rgba(0, 0, 0, 1) 100%
      );
      position: relative;
      overflow: hidden;
    }

    .project-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at top left,
        rgba(168, 85, 247, 0.12),
        transparent 70%
      );
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }

    .project-card:hover::before {
      opacity: 1;
    }
  </style>

  {
    projects.slice(0, 3).map((project) => (
      <div
        class="project-card relative flex items-center justify-between gap-12 p-16 min-h-[420px] rounded-2xl border border-[#2a2a2a]
               shadow-lg hover:shadow-[0_0_30px_rgba(168,85,247,0.25)]
               transition-all duration-500 ease-in-out mb-16 bg-opacity-5
               will-change-transform will-change-opacity max-w-6xl mx-auto"
      >
        <div class="flex-1 space-y-4 z-10">
          <h3 class="text-2xl font-bold">{project.title}</h3>
          <p class="text-gray-400 text-[15px] leading-relaxed max-w-md">
            {project.description}
          </p>
          <div class="flex gap-3 pt-4">
            {project.links.map((link) => (
              <a
                href={link.url}
                class={`px-5 py-2 rounded-full transition ${
                  link.type === "primary"
                    ? "bg-purple-600 text-white hover:bg-purple-700"
                    : "border border-gray-600 hover:bg-gray-800"
                }`}
              >
                {link.label}
              </a>
            ))}
          </div>
        </div>

        <div class="flex-1 flex justify-end z-10 w-full max-w-[400px]">
          <div class="relative w-full h-[250px] group/slider overflow-hidden rounded-xl shadow-lg">
            {project.images.map((image, index) => (
              <img
                src={image}
                alt={`${project.title} - Image ${index + 1}`}
                class={`absolute inset-0 w-full h-full object-cover object-top transition-opacity duration-1000 ease-in-out ${
                  index === 0 ? "opacity-100 z-10" : "opacity-0 z-0"
                }`}
                data-project-index={index}
              />
            ))}
          </div>
        </div>
      </div>
    ))
  }

  <div class="text-center mt-12">
    <a
      href="/projects"
      class="inline-flex items-center gap-2 px-8 py-3 bg-white/5 border border-white/10 rounded-full hover:bg-white/10 hover:border-purple-500/50 transition duration-300 group"
    >
      <span>View All Projects</span>
      <span class="group-hover:translate-x-1 transition-transform">â†’</span>
    </a>
  </div>
</section>

<script>
  function initSlideshows() {
    const sliders = document.querySelectorAll(".group\\/slider");

    sliders.forEach((slider) => {
      const images = slider.querySelectorAll("img");
      if (images.length <= 1) return;

      let currentIndex = 0;

      setInterval(() => {
        // Fade out current image
        images[currentIndex].classList.remove("opacity-100", "z-10");
        images[currentIndex].classList.add("opacity-0", "z-0");

        // Calculate next index
        currentIndex = (currentIndex + 1) % images.length;

        // Fade in next image
        images[currentIndex].classList.remove("opacity-0", "z-0");
        images[currentIndex].classList.add("opacity-100", "z-10");
      }, 3000); // Change every 3 seconds
    });
  }

  // Run on initial load
  initSlideshows();

  // Run on view transitions if enabled
  document.addEventListener("astro:page-load", initSlideshows);
</script>
